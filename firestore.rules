rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {

      // Disallow by default
      allow read, write: if false;


      // Allow updated by default
      match /codes/{code} {

        allow read: if true;
        allow update: if request.resource.data.diff(resource.data).affectedKeys().hasOnly( [ 'claimed', 'updated' ] )

      }

    }
  }
}